<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc (1.8.0_151) on Thu Apr 16 08:51:57 CST 2020 -->
<title>GenericJDBCLock</title>
<meta name="date" content="2020-04-16">
<link rel="stylesheet" type="text/css" href="../../../../../stylesheet.css" title="Style">
<script type="text/javascript" src="../../../../../script.js"></script>
</head>
<body>
<script type="text/javascript"><!--
    try {
        if (location.href.indexOf('is-external=true') == -1) {
            parent.document.title="GenericJDBCLock";
        }
    }
    catch(err) {
    }
//-->
var methods = {"i0":10,"i1":10,"i2":10,"i3":10};
var tabs = {65535:["t0","All Methods"],2:["t2","Instance Methods"],8:["t4","Concrete Methods"]};
var altColor = "altColor";
var rowColor = "rowColor";
var tableTab = "tableTab";
var activeTableTab = "activeTableTab";
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar.top">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.top" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.top.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../../org/apache/karaf/main/lock/GenericDataSource.html" title="class in org.apache.karaf.main.lock"><span class="typeNameLink">Prev&nbsp;Class</span></a></li>
<li><a href="../../../../../org/apache/karaf/main/lock/GenericStatements.html" title="class in org.apache.karaf.main.lock"><span class="typeNameLink">Next&nbsp;Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../../index.html?org/apache/karaf/main/lock/GenericJDBCLock.html" target="_top">Frames</a></li>
<li><a href="GenericJDBCLock.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li><a href="#field.summary">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor.summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li><a href="#field.detail">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor.detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a name="skip.navbar.top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="subTitle">org.apache.karaf.main.lock</div>
<h2 title="Class GenericJDBCLock" class="title">Class GenericJDBCLock</h2>
</div>
<div class="contentContainer">
<ul class="inheritance">
<li>java.lang.Object</li>
<li>
<ul class="inheritance">
<li>org.apache.karaf.main.lock.GenericJDBCLock</li>
</ul>
</li>
</ul>
<div class="description">
<ul class="blockList">
<li class="blockList">
<dl>
<dt>All Implemented Interfaces:</dt>
<dd><a href="../../../../../org/apache/karaf/main/lock/Lock.html" title="interface in org.apache.karaf.main.lock">Lock</a></dd>
</dl>
<hr>
<br>
<pre>public class <span class="typeNameLabel">GenericJDBCLock</span>
extends java.lang.Object
implements <a href="../../../../../org/apache/karaf/main/lock/Lock.html" title="interface in org.apache.karaf.main.lock">Lock</a></pre>
<div class="block"><p>This class is the base class used to provide a master/slave configuration for
 a given set of active karaf instances using JDBC. </p>

 <p>This implementation uses two different tables.  A KARAF_NODE_ID, and KARAF_LOCK tables.  The
 KARAF_NODE_ID table is used to generate a unique id for each instance in the cluster.  While
 the KARAF_LOCK table is used to determine who is the master of these instances. </p>

 <p>The tables configurations for the different tables are. </p>

 <pre>
   CREATE TABLE KARAF_NODE_ID ( ID INTEGER DEFAULT 0 )
   CREATE TABLE KARAF_LOCK ( ID INTEGER DEFAULT 0, STATE INTEGER DEFAULT 0, LOCK_DELAY INTEGER DEFAULT 0 )
 </pre>

 <p>The two tables will include a single row each that is created by a single instance in the cluster. </p>

 <p>The KARAF_NODE_ID table will be updated once for each active karaf instance with there unique id compared
 to the other instances within the cluster.  The single row will contain the next available unique id and
 will not include each clustered instance unique id since these instances can come and go throughout the
 system lifetime. </p>

 <p>The KARAF_LOCK table will be used to determine which of the instances will become the master. The master
 will set the STATE to an initial value and the LOCK_DELAY to a time in milliseconds of when the
 table will be updated.  It is the responsibility of the master instance to update the STATE field by the
 allocated lock delay by incrementing the state value.  If the STATE value has not been updated by the 
 LOCK_DELAY time then a slave has permission to attempt to become the master. </p>

 <p>While the overview does not describe exactly how this is implemented.  Here is a description of how this
 is done and what is provides as a fail safe solution. </p>

 <p>Each instance of this class provides an initialization step, a lock, isAlive and release interface. </p>

 <p>INITIALIZE:</p>

 <p>During the initialization step it will determine if the given tables exist within the database.  We only
 check for a single table since we assume that if one is available then the other must exist. We then
 add a row to each of the tables.  The added row to the KARAF_NODE_ID table will set the ID to zero since 
 this is consider a non-existent karaf instance.  The added row to the KARAF_LOCK will set the ID to zero
 which allows a karaf instances to acquire the lock and become the master instance. </p>


 <p>LOCK:</p>

 <p>The current instance will try to acquire the master lock by using the following sql statement. </p>

 <pre>
   UPDATE KARAF_LOCK SET ID = unique_id, STATE = state, LOCK_DELAY = lock_delay 
       WHERE ID = 0 OR ID = curId
 </pre>

 <p>Now you must be asking why are we using this update statement? The reason is that the statement will
 guarantee that only one instance will be able to update this row.  The curId is set to this instance
 unique id or to the prior master unique id if the row was not updated within that master lock_delay. </p>

 <p>The current update command will set the curId to this instance unique id.  If this fails then it will
 determine if the current master has not updated the row within its lock_delay.  If it hasn't updated
 the row within the allocated time then this instance can try to become the master. </p>

 <p>The current slave instance will then try to steal the lock from the master instance.  Why are we trying
 to steal the lock from the master?  The reason is that it is possible that the master instance had a 
 hard failure and there is no mechanisms to determine if that is the case. We then assume that it has 
 crashed without releasing the lock gracefully.  The slave instance then used the following update statement. </p>

 <pre>
   UPDATE KARAF_LOCK SET ID = unique_id, STATE = state, LOCK_DELAY = lock_delay 
       WHERE ( ID = 0 OR ID = curId ) AND STATE = curState
 </pre>

 <p>Now why are we using the state value as part of the where clause?  The reason that even though the row was
 not updated by the allocated delay time.  It is possible that the update statement was performed just after 
 the current slave check.  This update will insure that the row will be updated if and only if the state was
 also not updated.  It is possible that the master instance updated the row after the current slave check 
 and we do not want the slave to update the row and make itself the master.  This will insure that that will
 not be the case. </p>

 <p>ISALIVE: </p>

 <p>This just checks if the connection is active and then just updates the row's STATE by using the lock
 update call mentioned above. </p>

 <p>RELEASE: </p>

 <p>The release process just updates the KARAF_LOCK ID to zero so that other instances will have a chance
 to become the master. </p>

 <p>There are two main scenarios that we need to worry about.  Soft and Hard failures.  The soft failure
 basically allows the master instance to release the master lock and allow other instances to become
 the master.  As for a hard failure, the current karaf instance crashes and does not release the lock
 then the other karaf instances will notice that the KARAF_LOCK has not been updated for the current
 master id and then they can compete for the master lock. </p></div>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- =========== FIELD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="field.summary">
<!--   -->
</a>
<h3>Field Summary</h3>
<table class="memberSummary" border="0" cellpadding="3" cellspacing="0" summary="Field Summary table, listing fields, and an explanation">
<caption><span>Fields</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Field and Description</th>
</tr>
<tr class="altColor">
<td class="colFirst"><code>static java.lang.String</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../org/apache/karaf/main/lock/GenericJDBCLock.html#DEFAULT_CACHE">DEFAULT_CACHE</a></span></code>&nbsp;</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>static java.lang.String</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../org/apache/karaf/main/lock/GenericJDBCLock.html#DEFAULT_CLUSTERNAME">DEFAULT_CLUSTERNAME</a></span></code>&nbsp;</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>static java.lang.String</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../org/apache/karaf/main/lock/GenericJDBCLock.html#DEFAULT_PASSWORD">DEFAULT_PASSWORD</a></span></code>&nbsp;</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>static java.lang.String</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../org/apache/karaf/main/lock/GenericJDBCLock.html#DEFAULT_TABLE">DEFAULT_TABLE</a></span></code>&nbsp;</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>static java.lang.String</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../org/apache/karaf/main/lock/GenericJDBCLock.html#DEFAULT_TABLE_ID">DEFAULT_TABLE_ID</a></span></code>&nbsp;</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>static java.lang.String</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../org/apache/karaf/main/lock/GenericJDBCLock.html#DEFAULT_USER">DEFAULT_USER</a></span></code>&nbsp;</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>static java.lang.String</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../org/apache/karaf/main/lock/GenericJDBCLock.html#DEFAULT_VALID_TIMEOUT">DEFAULT_VALID_TIMEOUT</a></span></code>&nbsp;</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>static java.lang.String</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../org/apache/karaf/main/lock/GenericJDBCLock.html#PROPERTY_LOCK_JDBC_CACHE">PROPERTY_LOCK_JDBC_CACHE</a></span></code>&nbsp;</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>static java.lang.String</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../org/apache/karaf/main/lock/GenericJDBCLock.html#PROPERTY_LOCK_JDBC_CLUSTERNAME">PROPERTY_LOCK_JDBC_CLUSTERNAME</a></span></code>&nbsp;</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>static java.lang.String</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../org/apache/karaf/main/lock/GenericJDBCLock.html#PROPERTY_LOCK_JDBC_DRIVER">PROPERTY_LOCK_JDBC_DRIVER</a></span></code>&nbsp;</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>static java.lang.String</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../org/apache/karaf/main/lock/GenericJDBCLock.html#PROPERTY_LOCK_JDBC_PASSWORD">PROPERTY_LOCK_JDBC_PASSWORD</a></span></code>&nbsp;</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>static java.lang.String</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../org/apache/karaf/main/lock/GenericJDBCLock.html#PROPERTY_LOCK_JDBC_TABLE">PROPERTY_LOCK_JDBC_TABLE</a></span></code>&nbsp;</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>static java.lang.String</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../org/apache/karaf/main/lock/GenericJDBCLock.html#PROPERTY_LOCK_JDBC_TABLE_ID">PROPERTY_LOCK_JDBC_TABLE_ID</a></span></code>&nbsp;</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>static java.lang.String</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../org/apache/karaf/main/lock/GenericJDBCLock.html#PROPERTY_LOCK_JDBC_USER">PROPERTY_LOCK_JDBC_USER</a></span></code>&nbsp;</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>static java.lang.String</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../org/apache/karaf/main/lock/GenericJDBCLock.html#PROPERTY_LOCK_JDBC_VALID_TIMEOUT">PROPERTY_LOCK_JDBC_VALID_TIMEOUT</a></span></code>&nbsp;</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>static java.lang.String</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../org/apache/karaf/main/lock/GenericJDBCLock.html#PROPERTY_LOCK_URL">PROPERTY_LOCK_URL</a></span></code>&nbsp;</td>
</tr>
</table>
</li>
</ul>
<!-- ======== CONSTRUCTOR SUMMARY ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor.summary">
<!--   -->
</a>
<h3>Constructor Summary</h3>
<table class="memberSummary" border="0" cellpadding="3" cellspacing="0" summary="Constructor Summary table, listing constructors, and an explanation">
<caption><span>Constructors</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colOne" scope="col">Constructor and Description</th>
</tr>
<tr class="altColor">
<td class="colOne"><code><span class="memberNameLink"><a href="../../../../../org/apache/karaf/main/lock/GenericJDBCLock.html#GenericJDBCLock-Properties-">GenericJDBCLock</a></span>(Properties&nbsp;props)</code>&nbsp;</td>
</tr>
</table>
</li>
</ul>
<!-- ========== METHOD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="method.summary">
<!--   -->
</a>
<h3>Method Summary</h3>
<table class="memberSummary" border="0" cellpadding="3" cellspacing="0" summary="Method Summary table, listing methods, and an explanation">
<caption><span id="t0" class="activeTableTab"><span>All Methods</span><span class="tabEnd">&nbsp;</span></span><span id="t2" class="tableTab"><span><a href="javascript:show(2);">Instance Methods</a></span><span class="tabEnd">&nbsp;</span></span><span id="t4" class="tableTab"><span><a href="javascript:show(8);">Concrete Methods</a></span><span class="tabEnd">&nbsp;</span></span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Method and Description</th>
</tr>
<tr id="i0" class="altColor">
<td class="colFirst"><code>protected java.sql.Connection</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../org/apache/karaf/main/lock/GenericJDBCLock.html#getConnection--">getConnection</a></span>()</code>
<div class="block">This method will return an active connection for this given jdbc driver.</div>
</td>
</tr>
<tr id="i1" class="rowColor">
<td class="colFirst"><code>boolean</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../org/apache/karaf/main/lock/GenericJDBCLock.html#isAlive--">isAlive</a></span>()</code>
<div class="block">This method will check if the jdbc connection is still active and if we were able to 
 acquire or update the karaf_table information.</div>
</td>
</tr>
<tr id="i2" class="altColor">
<td class="colFirst"><code>boolean</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../org/apache/karaf/main/lock/GenericJDBCLock.html#lock--">lock</a></span>()</code>
<div class="block">This method is called whenever we want to acquire/steal or update the lock.</div>
</td>
</tr>
<tr id="i3" class="rowColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../org/apache/karaf/main/lock/GenericJDBCLock.html#release--">release</a></span>()</code>
<div class="block">This method will release the lock that the current master has by setting the karaf_lock table
 id to 0.</div>
</td>
</tr>
</table>
<ul class="blockList">
<li class="blockList"><a name="methods.inherited.from.class.java.lang.Object">
<!--   -->
</a>
<h3>Methods inherited from class&nbsp;java.lang.Object</h3>
<code>clone, equals, finalize, getClass, hashCode, notify, notifyAll, toString, wait, wait, wait</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ============ FIELD DETAIL =========== -->
<ul class="blockList">
<li class="blockList"><a name="field.detail">
<!--   -->
</a>
<h3>Field Detail</h3>
<a name="PROPERTY_LOCK_URL">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>PROPERTY_LOCK_URL</h4>
<pre>public static final&nbsp;java.lang.String PROPERTY_LOCK_URL</pre>
<dl>
<dt><span class="seeLabel">See Also:</span></dt>
<dd><a href="../../../../../constant-values.html#org.apache.karaf.main.lock.GenericJDBCLock.PROPERTY_LOCK_URL">Constant Field Values</a></dd>
</dl>
</li>
</ul>
<a name="PROPERTY_LOCK_JDBC_DRIVER">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>PROPERTY_LOCK_JDBC_DRIVER</h4>
<pre>public static final&nbsp;java.lang.String PROPERTY_LOCK_JDBC_DRIVER</pre>
<dl>
<dt><span class="seeLabel">See Also:</span></dt>
<dd><a href="../../../../../constant-values.html#org.apache.karaf.main.lock.GenericJDBCLock.PROPERTY_LOCK_JDBC_DRIVER">Constant Field Values</a></dd>
</dl>
</li>
</ul>
<a name="PROPERTY_LOCK_JDBC_USER">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>PROPERTY_LOCK_JDBC_USER</h4>
<pre>public static final&nbsp;java.lang.String PROPERTY_LOCK_JDBC_USER</pre>
<dl>
<dt><span class="seeLabel">See Also:</span></dt>
<dd><a href="../../../../../constant-values.html#org.apache.karaf.main.lock.GenericJDBCLock.PROPERTY_LOCK_JDBC_USER">Constant Field Values</a></dd>
</dl>
</li>
</ul>
<a name="PROPERTY_LOCK_JDBC_PASSWORD">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>PROPERTY_LOCK_JDBC_PASSWORD</h4>
<pre>public static final&nbsp;java.lang.String PROPERTY_LOCK_JDBC_PASSWORD</pre>
<dl>
<dt><span class="seeLabel">See Also:</span></dt>
<dd><a href="../../../../../constant-values.html#org.apache.karaf.main.lock.GenericJDBCLock.PROPERTY_LOCK_JDBC_PASSWORD">Constant Field Values</a></dd>
</dl>
</li>
</ul>
<a name="PROPERTY_LOCK_JDBC_TABLE">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>PROPERTY_LOCK_JDBC_TABLE</h4>
<pre>public static final&nbsp;java.lang.String PROPERTY_LOCK_JDBC_TABLE</pre>
<dl>
<dt><span class="seeLabel">See Also:</span></dt>
<dd><a href="../../../../../constant-values.html#org.apache.karaf.main.lock.GenericJDBCLock.PROPERTY_LOCK_JDBC_TABLE">Constant Field Values</a></dd>
</dl>
</li>
</ul>
<a name="PROPERTY_LOCK_JDBC_TABLE_ID">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>PROPERTY_LOCK_JDBC_TABLE_ID</h4>
<pre>public static final&nbsp;java.lang.String PROPERTY_LOCK_JDBC_TABLE_ID</pre>
<dl>
<dt><span class="seeLabel">See Also:</span></dt>
<dd><a href="../../../../../constant-values.html#org.apache.karaf.main.lock.GenericJDBCLock.PROPERTY_LOCK_JDBC_TABLE_ID">Constant Field Values</a></dd>
</dl>
</li>
</ul>
<a name="PROPERTY_LOCK_JDBC_CLUSTERNAME">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>PROPERTY_LOCK_JDBC_CLUSTERNAME</h4>
<pre>public static final&nbsp;java.lang.String PROPERTY_LOCK_JDBC_CLUSTERNAME</pre>
<dl>
<dt><span class="seeLabel">See Also:</span></dt>
<dd><a href="../../../../../constant-values.html#org.apache.karaf.main.lock.GenericJDBCLock.PROPERTY_LOCK_JDBC_CLUSTERNAME">Constant Field Values</a></dd>
</dl>
</li>
</ul>
<a name="PROPERTY_LOCK_JDBC_CACHE">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>PROPERTY_LOCK_JDBC_CACHE</h4>
<pre>public static final&nbsp;java.lang.String PROPERTY_LOCK_JDBC_CACHE</pre>
<dl>
<dt><span class="seeLabel">See Also:</span></dt>
<dd><a href="../../../../../constant-values.html#org.apache.karaf.main.lock.GenericJDBCLock.PROPERTY_LOCK_JDBC_CACHE">Constant Field Values</a></dd>
</dl>
</li>
</ul>
<a name="PROPERTY_LOCK_JDBC_VALID_TIMEOUT">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>PROPERTY_LOCK_JDBC_VALID_TIMEOUT</h4>
<pre>public static final&nbsp;java.lang.String PROPERTY_LOCK_JDBC_VALID_TIMEOUT</pre>
<dl>
<dt><span class="seeLabel">See Also:</span></dt>
<dd><a href="../../../../../constant-values.html#org.apache.karaf.main.lock.GenericJDBCLock.PROPERTY_LOCK_JDBC_VALID_TIMEOUT">Constant Field Values</a></dd>
</dl>
</li>
</ul>
<a name="DEFAULT_PASSWORD">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>DEFAULT_PASSWORD</h4>
<pre>public static final&nbsp;java.lang.String DEFAULT_PASSWORD</pre>
<dl>
<dt><span class="seeLabel">See Also:</span></dt>
<dd><a href="../../../../../constant-values.html#org.apache.karaf.main.lock.GenericJDBCLock.DEFAULT_PASSWORD">Constant Field Values</a></dd>
</dl>
</li>
</ul>
<a name="DEFAULT_USER">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>DEFAULT_USER</h4>
<pre>public static final&nbsp;java.lang.String DEFAULT_USER</pre>
<dl>
<dt><span class="seeLabel">See Also:</span></dt>
<dd><a href="../../../../../constant-values.html#org.apache.karaf.main.lock.GenericJDBCLock.DEFAULT_USER">Constant Field Values</a></dd>
</dl>
</li>
</ul>
<a name="DEFAULT_TABLE">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>DEFAULT_TABLE</h4>
<pre>public static final&nbsp;java.lang.String DEFAULT_TABLE</pre>
<dl>
<dt><span class="seeLabel">See Also:</span></dt>
<dd><a href="../../../../../constant-values.html#org.apache.karaf.main.lock.GenericJDBCLock.DEFAULT_TABLE">Constant Field Values</a></dd>
</dl>
</li>
</ul>
<a name="DEFAULT_TABLE_ID">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>DEFAULT_TABLE_ID</h4>
<pre>public static final&nbsp;java.lang.String DEFAULT_TABLE_ID</pre>
<dl>
<dt><span class="seeLabel">See Also:</span></dt>
<dd><a href="../../../../../constant-values.html#org.apache.karaf.main.lock.GenericJDBCLock.DEFAULT_TABLE_ID">Constant Field Values</a></dd>
</dl>
</li>
</ul>
<a name="DEFAULT_CLUSTERNAME">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>DEFAULT_CLUSTERNAME</h4>
<pre>public static final&nbsp;java.lang.String DEFAULT_CLUSTERNAME</pre>
<dl>
<dt><span class="seeLabel">See Also:</span></dt>
<dd><a href="../../../../../constant-values.html#org.apache.karaf.main.lock.GenericJDBCLock.DEFAULT_CLUSTERNAME">Constant Field Values</a></dd>
</dl>
</li>
</ul>
<a name="DEFAULT_CACHE">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>DEFAULT_CACHE</h4>
<pre>public static final&nbsp;java.lang.String DEFAULT_CACHE</pre>
<dl>
<dt><span class="seeLabel">See Also:</span></dt>
<dd><a href="../../../../../constant-values.html#org.apache.karaf.main.lock.GenericJDBCLock.DEFAULT_CACHE">Constant Field Values</a></dd>
</dl>
</li>
</ul>
<a name="DEFAULT_VALID_TIMEOUT">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>DEFAULT_VALID_TIMEOUT</h4>
<pre>public static final&nbsp;java.lang.String DEFAULT_VALID_TIMEOUT</pre>
<dl>
<dt><span class="seeLabel">See Also:</span></dt>
<dd><a href="../../../../../constant-values.html#org.apache.karaf.main.lock.GenericJDBCLock.DEFAULT_VALID_TIMEOUT">Constant Field Values</a></dd>
</dl>
</li>
</ul>
</li>
</ul>
<!-- ========= CONSTRUCTOR DETAIL ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor.detail">
<!--   -->
</a>
<h3>Constructor Detail</h3>
<a name="GenericJDBCLock-Properties-">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>GenericJDBCLock</h4>
<pre>public&nbsp;GenericJDBCLock(Properties&nbsp;props)</pre>
</li>
</ul>
</li>
</ul>
<!-- ============ METHOD DETAIL ========== -->
<ul class="blockList">
<li class="blockList"><a name="method.detail">
<!--   -->
</a>
<h3>Method Detail</h3>
<a name="getConnection--">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getConnection</h4>
<pre>protected&nbsp;java.sql.Connection&nbsp;getConnection()
                                     throws java.lang.Exception</pre>
<div class="block">This method will return an active connection for this given jdbc driver.</div>
<dl>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>The JDBC connection instance</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code>java.lang.Exception</code> - If the JDBC connection can't be retrieved.</dd>
</dl>
</li>
</ul>
<a name="lock--">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>lock</h4>
<pre>public&nbsp;boolean&nbsp;lock()
             throws java.lang.Exception</pre>
<div class="block">This method is called whenever we want to acquire/steal or update the lock.
 The different option depend if we are the competing for the master or the lock delay time
 has been exceeded or that we are the master and are update the state.</div>
<dl>
<dt><span class="overrideSpecifyLabel">Specified by:</span></dt>
<dd><code><a href="../../../../../org/apache/karaf/main/lock/Lock.html#lock--">lock</a></code>&nbsp;in interface&nbsp;<code><a href="../../../../../org/apache/karaf/main/lock/Lock.html" title="interface in org.apache.karaf.main.lock">Lock</a></code></dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>True, if we are the master instance else false.</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code>java.lang.Exception</code> - If the lock can't be acquired.</dd>
<dt><span class="seeLabel">See Also:</span></dt>
<dd><a href="../../../../../org/apache/karaf/main/lock/Lock.html#lock--"><code>Lock.lock()</code></a></dd>
</dl>
</li>
</ul>
<a name="release--">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>release</h4>
<pre>public&nbsp;void&nbsp;release()
             throws java.lang.Exception</pre>
<div class="block">This method will release the lock that the current master has by setting the karaf_lock table
 id to 0.  This tells the others that the master has relinquished the lock and someone else can
 try to acquire that lock and become a master.</div>
<dl>
<dt><span class="overrideSpecifyLabel">Specified by:</span></dt>
<dd><code><a href="../../../../../org/apache/karaf/main/lock/Lock.html#release--">release</a></code>&nbsp;in interface&nbsp;<code><a href="../../../../../org/apache/karaf/main/lock/Lock.html" title="interface in org.apache.karaf.main.lock">Lock</a></code></dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code>java.lang.Exception</code> - If the lock can't be released.</dd>
<dt><span class="seeLabel">See Also:</span></dt>
<dd><a href="../../../../../org/apache/karaf/main/lock/Lock.html#release--"><code>Lock.release()</code></a></dd>
</dl>
</li>
</ul>
<a name="isAlive--">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>isAlive</h4>
<pre>public&nbsp;boolean&nbsp;isAlive()
                throws java.lang.Exception</pre>
<div class="block">This method will check if the jdbc connection is still active and if we were able to 
 acquire or update the karaf_table information.</div>
<dl>
<dt><span class="overrideSpecifyLabel">Specified by:</span></dt>
<dd><code><a href="../../../../../org/apache/karaf/main/lock/Lock.html#isAlive--">isAlive</a></code>&nbsp;in interface&nbsp;<code><a href="../../../../../org/apache/karaf/main/lock/Lock.html" title="interface in org.apache.karaf.main.lock">Lock</a></code></dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>True, if the connection is still active and we still have the lock.</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code>java.lang.Exception</code> - If an error occurs while checking if the lock is alive.</dd>
<dt><span class="seeLabel">See Also:</span></dt>
<dd><a href="../../../../../org/apache/karaf/main/lock/Lock.html#isAlive--"><code>Lock.isAlive()</code></a></dd>
</dl>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<!-- ========= END OF CLASS DATA ========= -->
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar.bottom">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.bottom" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.bottom.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../../org/apache/karaf/main/lock/GenericDataSource.html" title="class in org.apache.karaf.main.lock"><span class="typeNameLink">Prev&nbsp;Class</span></a></li>
<li><a href="../../../../../org/apache/karaf/main/lock/GenericStatements.html" title="class in org.apache.karaf.main.lock"><span class="typeNameLink">Next&nbsp;Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../../index.html?org/apache/karaf/main/lock/GenericJDBCLock.html" target="_top">Frames</a></li>
<li><a href="GenericJDBCLock.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li><a href="#field.summary">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor.summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li><a href="#field.detail">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor.detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a name="skip.navbar.bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
</body>
</html>
